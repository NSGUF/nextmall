# Admin Dashboard 功能说明

## 概述

为NextMall项目设计并实现了一个功能完整的管理后台首页，包含以下核心功能：

## 功能特性

### 1. 用户统计模块

- **用户总量**: 显示系统中所有未删除的用户总数
- **今日活跃用户**: 基于操作日志统计今日有操作记录的用户数
- **昨日活跃用户**: 统计昨日活跃用户数量
- **当月活跃用户**: 统计本月活跃用户数量
- **上月活跃用户**: 统计上月活跃用户数量

### 2. 订单统计模块

- **订单总量**: 显示系统中所有未删除的订单总数
- **今日订单**: 统计今日新增订单数量
- **昨日订单**: 统计昨日订单数量
- **当月订单**: 统计本月订单数量
- **上月订单**: 统计上月订单数量

### 3. 成交统计模块

- **成交总量**: 显示已完成订单的数量和总金额
- **今日成交**: 统计今日完成的订单数量和金额
- **昨日成交**: 统计昨日成交数据
- **当月成交**: 统计本月成交数据
- **上月成交**: 统计上月成交数据

### 4. 库存预警模块

- 自动检测库存低于10的商品规格
- 显示商品信息、规格详情、供应商信息
- 按库存数量进行颜色分级警告（红色≤3，橙色≤6，黄色≤9）
- 支持商品图片展示和价格信息

### 5. 供应商数据查看模块

- **筛选功能**: 支持按供应商和年份筛选数据
- **月度统计**: 显示每个供应商每月的订单数量和金额
- **分页展示**: 支持大量数据的分页浏览
- **独立页面**: 提供专门的供应商数据查看页面 (`/admin/vendor-data`)

## 技术实现

### 后端API (tRPC)

创建了 `dashboardRouter` 包含以下接口：

- `getUserStats`: 获取用户统计数据
- `getOrderStats`: 获取订单统计数据
- `getTransactionStats`: 获取成交统计数据
- `getStockAlerts`: 获取库存预警数据
- `getVendorData`: 获取供应商数据（支持分页和筛选）
- `getVendorList`: 获取供应商列表

### 前端组件

- `StatCard`: 可复用的统计卡片组件
- `StockAlert`: 库存预警列表组件
- `VendorDataView`: 供应商数据查看组件

### 数据统计逻辑

- 使用Prisma ORM进行数据库查询
- 支持日期范围筛选和分组统计
- 通过操作日志表统计用户活跃度
- 基于订单状态统计成交数据

## 页面结构

### 主页面 (`/admin`)

- 响应式网格布局
- 分模块展示各类统计数据
- 实时数据加载和错误处理

### 供应商数据页面 (`/admin/vendor-data`)

- 独立的数据查看界面
- 高级筛选和分页功能
- 详细的月度数据展示

## 使用说明

1. **访问首页**: 导航到 `/admin` 查看总体数据概览
2. **查看库存预警**: 在首页下方查看库存不足的商品
3. **分析供应商数据**:
    - 在首页查看简要的供应商数据
    - 点击侧边栏"供应商数据"进入详细页面
    - 使用筛选器按供应商或年份查看数据

## 权限控制

所有dashboard相关的API接口都使用 `superAdminProcedure`，确保只有超级管理员才能访问这些敏感的统计数据。

## 扩展性

该设计具有良好的扩展性：

- 可以轻松添加新的统计指标
- 支持添加图表组件进行数据可视化
- 可以扩展更多的筛选和排序功能
- 支持导出功能的集成

## 性能优化

- 使用数据库聚合查询减少数据传输
- 实现分页减少单次查询数据量
- 使用tRPC的缓存机制提升响应速度
- 组件级别的加载状态管理
